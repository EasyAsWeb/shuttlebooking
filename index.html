<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <!-- JQuery Libs -->
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <!-- Moment JS -->
  <!-- <script type="text/javascript" src="js/moment.js"></script> -->
  <!-- <script "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"></script> -->
  <script type="text/javascript" src="js/moment.min.js"></script>
  <!-- Bootstrap -->
  <link href="https://netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <link href="css/styles.css" rel="stylesheet" id="bootstrap-css">
  <!-- DatePicker JQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
  <!-- Google Maps Library -->
  <script defer src="https://maps.googleapis.com/maps/api/js?libraries=places&language=en&key=AIzaSyDaqml-GXgNO5R6nO4g3X78HNjJ7TqeUPo" type="text/javascript"></script>
  <!-- Stripe Library -->
  <!-- <script type="text/javascript" src="js/stripecc.js"></script> -->
  <script src="https://js.stripe.com/v3/"></script>
</head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <form id="distance_form">
            <div class="form-group">
              <label>Origin: </label>
              <input  id="from_places" class="form-control" placeholder="Enter a location" />
              <input id="origin" type="hidden" name="origin" required/>
           </div>

              <div class="form-group">
                <label>Destination: </label>
                <input  id="to_places" class="form-control" placeholder="Enter a location" />
                <input id="destination" type="hidden" name="destination" required/>
           </div>

          <div class="row">
            <div class='col-sm-6'>
              <br><label>Pick Up Date/Time: </label>
              <div class="form-group">
                <div class='input-group date' id='datetimepicker1'>
                  <input type='text' class="form-control" />
                  <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                  </span>
                </div>
              </div>
            </div>
          </div>
              <input type="submit" value="Calculate" class="btn btn-primary"/>
          </form>

                <div id="result">
                  <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      Distance (km):
                      <span id='in_kilo' class="badge badge-primary badge-pill"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      Fare ($NZD):
                      <span id="fare_nzd" class="badge badge-primary badge-pill"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      IN TEXT:
                      <span id="duration_text" class="badge badge-primary badge-pill"></span>
                    </li>
                    <!-- <li  class="list-group-item d-flex justify-content-between align-items-center">
                    IN MINUTES:
                    <span id="duration_value" class="badge badge-primary badge-pill"></span>
                    </li> -->

                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      FROM:
                      <span id="from" class="badge badge-primary badge-pill"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      TO:
                      <span id="to" class="badge badge-primary badge-pill"></span>
                    </li>
                  </ul>
                  <form>
                    <input type="button" value="Book Now" onclick="msg()" class="btn btn-primary">
                  </form>
                </div>

                <form id="bookInfo">
                  <div class="row">

                    <div class="form-group row">
                      <label for="colFormLabel" class="col-sm-2 col-form-label">first name</label>
                      <div class="col-sm-10">
                        <input type="name" class="form-control" id="colFormLabel" placeholder="col-form-label">
                      </div>
                      </div>

                      <div class="form-group row">
                        <label for="colFormLabel" class="col-sm-2 col-form-label">Last name</label>
                        <div class="col-sm-10">
                          <input type="email" class="form-control" id="colFormLabel" placeholder="col-form-label">
                        </div>
                        </div>

                        <div class="form-group row">
                          <label for="colFormLabel" class="col-sm-2 col-form-label">Mobile</label>
                            <div class="col-sm-10">
                              <input type="name" class="form-control" id="colFormLabel" placeholder="Please add mobile number  ">
                            </div>
                          </div>

                        </div>

                        <div class="form-group row">
                          <label for="colFormLabel" class="col-sm-2 col-form-label">Email</label>
                          <div class="col-sm-10">
                            <input type="email" class="form-control" id="colFormLabel" placeholder="We'll never share your email with anyone else.">
                          </div>
                          </div>

                          <div class="form-group row">
                            <label for="colFormLabel" class="col-sm-2 col-form-label">Payment Option</label>
                            <div class="col-sm-10">
                              <select class="form-control form-control-sm">
                                 <option>Bank/Poli</option>
                                 <option>EFTPOS</option>
                                 <option>Credit Card</option>
                                 <option>Cash</option>
                              </select>
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="exampleFormControlTextarea1">comments/instructions</label>
                            <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                          </div>
                </form>

                <form action="/charge" method="post" id="payment-form">
                  <div class="form-row">
                    <label for="card-element">Credit or debit card</label>
                    <div id="card-element">
                      <!-- A Stripe Element will be inserted here. -->
                    </div>
                    <!-- Used to display form errors. -->
                    <div id="card-errors" role="alert"></div>
                  </div>

                  <button class="btn btn-primary">Submit Payment</button>
                </form>

                <!-- <<div class="cognito">
          <script src="https://services.cognitoforms.com/s/Ly2VJ20R40uD_9XkM3BRAA"></script>
          <script>Cognito.load("forms", { id: "1" });</script>
          </div>
          <form>
              <input type="button" value="Book Now" class="btn btn-primary" onclick="send_fare();"/>
          </form>
          <p id="final_fare"></p>
              </div>
            </div>
        </div> -->
                <script type="text/javascript">
                  $(function() {
                    // add input listeners
                    google.maps.event.addDomListener(window, 'load', function() {
                      var options = {
                        componentRestrictions: {
                          country: "nz"
                        }
                      };

                      var from = document.getElementById('from_places');
                      var to = document.getElementById('to_places');
                      var from_places = new google.maps.places.Autocomplete(from, options);
                      var to_places = new google.maps.places.Autocomplete(to, options);
                      // var from_places = new google.maps.places.Autocomplete(document.getElementById('from_places'), options);
                      // var to_places = new google.maps.places.Autocomplete(document.getElementById('to_places'), options);
                      google.maps.event.addListener(from_places, 'place_changed', function() {
                        var from_place = from_places.getPlace();
                        var from_address = from_place.formatted_address;
                        $('#origin').val(from_address);
                      });

                      google.maps.event.addListener(to_places, 'place_changed', function() {
                        var to_place = to_places.getPlace();
                        var to_address = to_place.formatted_address;
                        $('#destination').val(to_address);
                      });
                    });

                    // calculate distance
                    function calculateDistance() {
                      var origin = $('#origin').val();
                      var destination = $('#destination').val();
                      var service = new google.maps.DistanceMatrixService();
                      service.getDistanceMatrix({
                        origins: [origin],
                        destinations: [destination],
                        travelMode: google.maps.TravelMode.DRIVING,
                        // unitSystem: google.maps.UnitSystem.IMPERIAL, // miles and feet.
                        unitSystem: google.maps.UnitSystem.metric, // kilometers and meters.
                        avoidHighways: false,
                        avoidTolls: false
                      }, callback);
                    } //end of calculateDistance()
                    // get distance results
                    function callback(response, status) {
                      if (status != google.maps.DistanceMatrixStatus.OK) {
                        $('#result').html(err);
                      } else {
                        var origin = response.originAddresses[0];
                        var destination = response.destinationAddresses[0];
                        if (response.rows[0].elements[0].status === "ZERO_RESULTS") {
                          $('#result').html("Better get on a plane. There are no roads between " + origin + " and " + destination);
                        } else {
                          var distance = response.rows[0].elements[0].distance;
                          var duration = response.rows[0].elements[0].duration;
                          console.log(response.rows[0].elements[0].distance);
                          var distance_in_kilo = distance.value / 1000; // the kilom
                          var fare_calc = (distance.value / 1000) * 3; // the mile
                          var duration_text = duration.text;
                          var duration_value = duration.value;
                          $('#fare_nzd').text(fare_calc.toFixed(2));
                          $('#in_kilo').text(distance_in_kilo.toFixed(2));
                          $('#duration_text').text(duration_text);
                          $('#duration_value').text(duration_value);
                          $('#from').text(origin);
                          $('#to').text(destination);
                        }
                      }
                    }
                    // print results on submit the form
                    $('#distance_form').submit(function(e) {
                      e.preventDefault();
                      calculateDistance();
                    });
                    $('#datetimepicker1').datetimepicker();
                  });

                  function msg() {
                    alert("this should trigger the booking form");
                  }
                </script>
    </body>
</html>
